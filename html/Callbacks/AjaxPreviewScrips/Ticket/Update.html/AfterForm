<%args>
$Ticket
</%args>
<%init>
return unless $Ticket->CurrentUserHasRight('ShowOutgoingEmail')
  or RT->Config->Get('SimplifiedRecipients', $session{'CurrentUser'});
</%init>
<script type="text/javascript">
jQuery( function() {
   var updateScrips = function() {
       CKEDITOR.instances['UpdateContent'].updateElement();
       var syncCheckboxes = function(ev) {
           jQuery("input[name=TxnSendMailTo]").filter( function() { return this.value == ev.target.value; } ).prop("checked",jQuery(ev.target).prop('checked'));
       };
       jQuery('#recipients div.titlebox-content').load( '<% RT->Config->Get('WebPath')%>/Helpers/ShowSimplifiedRecipients',
           jQuery('form[name=TicketUpdate]').serialize(),
           function() { jQuery("#recipients input[name=TxnSendMailTo]").change( syncCheckboxes ); }
       );
       jQuery('#previewscrips div.titlebox-content').load( '<% RT->Config->Get('WebPath')%>/Helpers/PreviewScrips',
           jQuery('form[name=TicketUpdate]').serialize(),
           function() { jQuery("#previewscrips input[name=TxnSendMailTo]").change( syncCheckboxes ); }
       );
   };
   updateScrips();
   CKEDITOR.instances['UpdateContent'].on('blur', updateScrips );
   jQuery("#ticket-update-metadata :input, input[name^=UpdateCc], input[name^=UpdateBcc]").change( updateScrips );
});
</script>
